<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <link rel="icon" type="image/png" href="http://lab.ejci.net/favico.js/html5logo.png" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>JSF+MetodosNumericos</title>
        <!--Import Google Icon Font-->
        <link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
        <meta charset="UTF-8"/>
        <!--Let browser know website is optimized for mobile-->
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <!-- Compiled and minified CSS -->
        <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.6/css/materialize.min.css"/>        
        <style>
            .configuracion{
                color: white !important;
            }
        </style>
    </head>
    <body>
        <!-- Navbar goes here -->
        <nav>
            <div class="nav-wrapper">
                <a href="#" class="brand-logo center">ABD JSF + Metodos Numericos</a>
                <ul id="nav-mobile" class="right hide-on-med-and-down">
                </ul>
            </div>
        </nav>
        <!-- Page Layout here -->
        <div class="row">
            <div class="col s2">
                <!-- Grey navigation panel -->
                <p>
                    <input class="with-gap group1" name="group1" value="b" type="radio" id="test1" checked="checked"/>
                    <label for="test1">
                        Bisección
                    </label>
                </p>
                <p>
                    <input class="with-gap group1" name="group1" value="fp" type="radio" id="test2" />
                    <label for="test2">
                        Falsa posición
                    </label>
                </p>
                <p>
                    <input class="with-gap group1" name="group1" value="pf" type="radio" id="test3"  />
                    <label for="test3">
                        Punto Fijo
                    </label>
                </p>
                <p>
                <div class="input-field col s6">
                    <input data-error="Debe Ser entre -100 y 0" data-success="listo!" placeholder="Placeholder" id="numeroInicial" type="number" value="-2" class="validate"/>
                    <label for="first_name">Inicio</label>
                </div>
                <div class="input-field col s6">
                    <input data-error="Debe ser entre 0 y 100" data-success="listo!" placeholder="Placeholder" id="numeroFinal" type="number" value="2" class="validate"/>
                    <label for="first_name">Fin</label>
                </div>
                <table class="centered striped table">
                    <thead>
                        <tr>
                            <th colspan="2">Tabla de Valores</th>
                        </tr>
                        <tr>
                            <th>X</th>
                            <th>Y</th>
                        </tr>
                    </thead>
                    <tbody id="xy">
                    </tbody>
                </table>
                </p>
            </div>

            <div class="col s9">
                <!-- Teal page content  -->
                <br/>
                <div class="row">
                    <div class="col s12">
                        <div class="input-field col s5">
                            <input placeholder="3x^3 + 2x^2 + x -1" id="funcion" type="text" class="validate"/>
                            <label for="first_name">Ingresa la Ecuación</label>
                        </div>
                        <div class="col s3">
                            <a data-position="bottom" data-delay="50" data-tooltip="Graficar" id="graficar" class="tooltipped btn-floating btn-large waves-effect waves-light red"><i class="material-icons">mode_edit</i></a>
                            <a data-position="bottom" data-delay="50" data-tooltip="Ejecutar" id="Ejecutar" class="tooltipped btn-floating btn-large waves-effect waves-light blue"><i class="material-icons">play_circle_outline</i></a>
                            <a data-position="bottom" data-delay="50" data-tooltip="Recargar" id="VolverAEjecutar" class="tooltipped btn-floating btn-large waves-effect waves-light purple"><i class="material-icons">replay</i></a>
                        </div>
                    </div>
                    <div class="col s12">
                        <div id="myPlot" style="width:100%;height:400px;background-repeat: no-repeat; background-position: center center;"></div>
                    </div>
                    <div class="col s12">
                        <table class="table responsive-table">
                            <thead>
                                <tr>
                                    <td colspan="6" class="center">Pila de Operaciones</td>
                                </tr>
                                <tr>
                                    <th data-field="id">Iteracion #</th>
                                    <th data-field="id">X<small>1</small></th>
                                    <th data-field="name">X<small>2</small></th>
                                    <th data-field="price">X<small>m</small></th>
                                    <th data-field="price">F(x<small>1</small>)</th>
                                    <th data-field="price">F(x<small>2</small>)</th>
                                    <th data-field="price">F(x<small>m</small>)</th>
                                </tr>
                            </thead>

                            <tbody id="Pila">
                            </tbody>
                        </table>
                    </div>

                </div>
            </div>
        </div>
        <div id="resutlado" class="modal">
            <div class="modal-content">
                <h4>La Raiz Es:</h4>
                <p id="resutadoRaiz"></p>
            </div>
            <div class="modal-footer">
                <a href="#!" class=" modal-action modal-close waves-effect waves-green btn-flat">Agree</a>
            </div>
        </div>
        <footer class="page-footer">
            <div class="container">
                <div class="row">
                    <div class="col l6 s12">
                        <h5 class="white-text">Integrantes</h5>
                        <p class="grey-text text-lighten-4"><a style="color: white" href="http://github.com/luisplata" target="_blank">Luis Enrique Plata Osorio</a></p>
                        <p class="grey-text text-lighten-4"><a style="color: white">Yordi Canoles</a></p>
                    </div>
                    <div class="col l4 offset-l2 s12">
                        <h5 class="white-text">Configuración</h5>
                        <ul style="color: white">
                            <li>                                
                                <div class="input-field">
                                    <input placeholder="" value="5" id="precisionDecimal" type="number" min="0" class="validate">
                                    <label for="precisionDecimal" class=" configuracion"  data-error="no" data-success="Ok">Precición Decimal</label>
                                </div>
                            </li>
                            <li>                                
                                <div class="input-field">
                                    <input placeholder="" value="5" id="errorAbsoluto" type="number" min="0" class="validate">
                                    <label for="errorAbsoluto" class=" configuracion"  data-error="no" data-success="Ok">Error Absoluto</label>
                                </div>
                            </li>
                            <li>                                
                                <div class="input-field">
                                    <input placeholder="" value="1000" id="velocidadDeIteracion" type="number" min="0" class="validate">
                                    <label for="velocidadDeIteracion" class=" configuracion"  data-error="no" data-success="Ok">Velocidad de Iteración</label>
                                </div>
                            </li>
                            <li>                                
                                <div class="input-field">
                                    <input placeholder="" value="50" id="maximasIteraciones" type="number" min="0" class="validate">
                                    <label for="maximasIteraciones" class=" configuracion" data-error="no" data-success="Ok">Iteraciones maximas</label>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="footer-copyright">
                <div class="container">
                    © 2014 Copyright Nabu.com.co
                    <a class="grey-text text-lighten-4 right" href="http://nabu.com.co" target="_blank">NABU</a>
                </div>
            </div>
        </footer>
        <!--Import jQuery before materialize.js-->
        <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
        <!-- Compiled and minified JavaScript -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.6/js/materialize.min.js"></script>
        <!--Graficador-->
        <script src="https://cdn.rawgit.com/luisplata/fooplot/master/fooplot.js"></script>
        <script src="https://cdn.rawgit.com/josdejong/mathjs/master/dist/math.min.js"></script>        
        <script>
            var myPlot;
            var precicionDecimal;
            var errorAbsoluto;
            var velocidadDeIteracion;
            var maximasIteraciones;
            $(document).ready(function () {

                //gif de cargado: http://i.imgur.com/D7WvclY.gif
                //Lo que vamos a hacer es lo sieguiente:
                /*
                 * Cuando de click, calcularemos la altura y ancho
                 del div donde esta el graficor,
                 * Y colocaremos la imagen del gif como background, y
                 */

                Materialize.updateTextFields();
            });
            $(document).on("click", "#VolverAEjecutar", function () {
                location.reload();
            });
            $(document).on("click", "#Ejecutar", function () {
                precicionDecimal = $("#precisionDecimal").val();
                errorAbsoluto = $("#errorAbsoluto").val();
                velocidadDeIteracion = $("#velocidadDeIteracion").val();
                maximasIteraciones = $("#maximasIteraciones").val();
                var selected = $("input[type='radio'][name='group1']:checked");
                if (selected.length > 0) {
                    selectedVal = selected.val();
                }
                switch (selectedVal) {
                    case "b":
                        biseccion(parseFloat($("#numeroInicial").val()), parseFloat($("#numeroFinal").val()), $("#funcion").val(), 0);
                        break;
                    case "fp":
                        falsaPosicion(parseFloat($("#numeroInicial").val()), parseFloat($("#numeroFinal").val()), $("#funcion").val(), 0);
                        break;
                    case "pf":
                        Materialize.toast('Función todavia en contrucción', 3000, 'rounded') // 'rounded' is the class I'm applying to the toast
                        break;
                }

            });
            $(document).on("click", "#graficar", function () {

                myPlot = new Fooplot(document.getElementById('myPlot'));
                var funcion = $("#funcion").val();//agregar mas funciones separadas por ;
                //myPlot.addPlot('sin(x)+0.5/x', FOOPLOT_TYPE_FUNCTION);
                myPlot.addPlot(funcion, FOOPLOT_TYPE_FUNCTION);
                //myPlot.addPlot('theta', FOOPLOT_TYPE_POLAR, {'color': '#ff0000'});
                myPlot.reDraw();
                tablaxy($("#funcion").val(), parseFloat($("#numeroInicial").val()), parseFloat($("#numeroFinal").val()));
            });

            function falsaPosicion(a, b, funcion, iteracion) {
                console.log(a + " " + b + " " + funcion + " " + iteracion);
                //Ejecutamos el resultado de f(a), f(b)
                var operacion = math.compile(funcion);
                var positivo = {x: a};
                var negativo = {x: b};
                var fa = operacion.eval(positivo);
                var fb = operacion.eval(negativo);
                var c = a - ((fa * (b - a)) / (fb - fa));
                var raiz = {x: c};
                var fr = operacion.eval(raiz);
                //buscamos el f(c)
                //comparamos la funcion de f(c)
                //Aqui Se Imprime en la tabla
                var tr = $("<tr/>");
                var iteracionNo = $("<td/>", {"html": iteracion});
                tr.append(iteracionNo);
                var tdx1 = $("<td/>", {"html": formatoNumero(Math.round10(a, -precicionDecimal))});
                tr.append(tdx1);
                var tdb1 = $("<td/>", {"html": formatoNumero(Math.round10(b, -precicionDecimal))});
                tr.append(tdb1);
                var tdc1 = $("<td/>", {"html": formatoNumero(Math.round10(c, -precicionDecimal))});
                tr.append(tdc1);
                var tdfx1 = $("<td/>", {"html": formatoNumero(Math.round10(fa, -precicionDecimal))});
                tr.append(tdfx1);
                var tdfb1 = $("<td/>", {"html": formatoNumero(Math.round10(fb, -precicionDecimal))});
                tr.append(tdfb1);
                var tdfc1 = $("<td/>", {"html": formatoNumero(Math.round10(fr, -precicionDecimal))});
                tr.append(tdfc1);
                $("#Pila").append(tr);

                console.log(a + "|" + b + "|" + c + "|" + parseFloat(fr) + "|");
                console.log("Iteracion # " + iteracion);
                //Se Imprime en la tabla
                if (fr > 0) {
                    //es positivo
                    a = c;
                } else {
                    b = c;
                }
                var ccs = "1e-" + precicionDecimal;
                if (fr <= parseFloat(ccs) && fr >= -parseFloat(ccs)) {
                    console.log("El Numero es: " + c + " Con la funcion da: " + parseFloat(fr + ""));
                    return;
                }
                iteracion++;
                if (iteracion >= maximasIteraciones) {
                    return;
                }
                setTimeout(function () {
                    falsaPosicion(a, b, funcion, iteracion);
                }, velocidadDeIteracion);

            }
            function biseccion(a, b, funcion, iteracion) {
                //Ejecutamos el resultado de f(a), f(b)
                var operacion = math.compile(funcion);
                var c = (a + b) / 2;
                var positivo = {x: a};
                var negativo = {x: b};
                var raiz = {x: c};
                var fa = operacion.eval(positivo);
                var fb = operacion.eval(negativo);
                var fr = operacion.eval(raiz);
                //buscamos el f(c)
                //comparamos la funcion de f(c)
                //Aqui Se Imprime en la tabla
                var tr = $("<tr/>");
                var iteracionNo = $("<td/>", {"html": iteracion});
                tr.append(iteracionNo);
                var tdx1 = $("<td/>", {"html": formatoNumero(Math.round10(a, -precicionDecimal))});
                tr.append(tdx1);
                var tdb1 = $("<td/>", {"html": formatoNumero(Math.round10(b, -precicionDecimal))});
                tr.append(tdb1);
                var tdc1 = $("<td/>", {"html": formatoNumero(Math.round10(c, -precicionDecimal))});
                tr.append(tdc1);
                var tdfx1 = $("<td/>", {"html": formatoNumero(Math.round10(fa, -precicionDecimal))});
                tr.append(tdfx1);
                var tdfb1 = $("<td/>", {"html": formatoNumero(Math.round10(fb, -precicionDecimal))});
                tr.append(tdfb1);
                var tdfc1 = $("<td/>", {"html": formatoNumero(Math.round10(fr, -precicionDecimal))});
                tr.append(tdfc1);
                $("#Pila").append(tr);
                console.log("Positivo    |Negativo    |Raiz    |fr      |");
                console.log(a + "            |" + b + "        |" + c + "    |" + parseFloat(fr + "") + "    |");
                console.log("Iteracion # " + iteracion);
                //Se Imprime en la tabla
                if (fr > 0) {
                    //es positivo
                    a = c;
                } else {
                    b = c;
                }
                var ccs = "1e-" + precicionDecimal;
                if (fr <= parseFloat(ccs) && fr >= -parseFloat(ccs)) {
                    console.log("El Numero es: " + c + " Con la funcion da: " + parseFloat(fr + ""));
                    //Colocar el resultado en el modal que anda por ahy con id resultado
                    Materialize.toast("El Numero es: " + c + " Con la funcion da: " + parseFloat(fr + ""), 4000);// 4000 is the duration of the toast
                    alert("El Numero es: " + c + " Con la funcion da: " + parseFloat(fr + ""));
                    return;
                }
                if (iteracion >= maximasIteraciones) {
                    return;
                }
                iteracion++;
                setTimeout(function () {
                    biseccion(a, b, funcion, iteracion);
                }, velocidadDeIteracion);
            }

            function tablaxy(funcion, limiteIzq, limiteDer) {
                var x1;
                var y1;
                if (isNaN(x1)) {
                    x1 = 0;
                }
                if (isNaN(y1)) {
                    y1 = 0;
                }
                if (funcion === "") {
                    funcion = 0;
                }
                var iteraciones = Math.abs(limiteIzq) + Math.abs(limiteDer);
                iteraciones /= 10;
                var funcionLocal = math.compile(funcion);
                for (var i = limiteIzq; i <= limiteDer; i += parseFloat(iteraciones)) {
                    var xx = {x: i};
                    x1 = i;
                    y1 = funcionLocal.eval(xx);
                    var tr = $("<tr/>");
                    var tdx = $('<td/>', {
                        "html": formatoNumero(Math.round10(x1, -5))
                    });
                    var tdy = $('<td/>', {
                        "html": formatoNumero(Math.round10(y1, -5))
                    });
                    tr.append(tdx);
                    tr.append(tdy);
                    console.log(tdx);
                    $("#xy").append(tr);
                    console.log("X= " + Math.round10(x1, -5));
                    console.log("Y= " + Math.round10(y1, -5));
                    console.log("i= " + Math.round10(xx.x, -5));
                }
            }
            Math.round10 = function (value, exp) {
                return decimalAdjust('round', value, exp);
            };
            function decimalAdjust(type, value, exp) {
                // Si el exp no está definido o es cero...
                if (typeof exp === 'undefined' || +exp === 0) {
                    return Math[type](value);
                }
                value = +value;
                exp = +exp;
                // Si el valor no es un número o el exp no es un entero...
                if (isNaN(value) || !(typeof exp === 'number' && exp % 1 === 0)) {
                    return NaN;
                }
                // Shift
                value = value.toString().split('e');
                value = Math[type](+(value[0] + 'e' + (value[1] ? (+value[1] - exp) : -exp)));
                // Shift back
                value = value.toString().split('e');
                return +(value[0] + 'e' + (value[1] ? (+value[1] + exp) : exp));
            }
            /**
             * Da formato a un número para su visualización
             *
             * @param {(number|string)} numero Número que se mostrará
             * @param {number} [decimales=null] Nº de decimales (por defecto, auto); admite valores negativos
             * @param {string} [separadorDecimal=","] Separador decimal
             * @param {string} [separadorMiles=""] Separador de miles
             * @returns {string} Número formateado o cadena vacía si no es un número
             *
             * @version 2014-07-18
             */
            function formatoNumero(numero) {
                var partes, array;
                var decimales = ".", separadorDecimal = ",", separadorMiles = ".";

                if (!isFinite(numero) || isNaN(numero = parseFloat(numero))) {
                    return "";
                }
                if (typeof separadorDecimal === "undefined") {
                    separadorDecimal = ",";
                }
                if (typeof separadorMiles === "undefined") {
                    separadorMiles = "";
                }

                // Redondeamos
                if (!isNaN(parseInt(decimales))) {
                    if (decimales >= 0) {
                        numero = numero.toFixed(decimales);
                    } else {
                        numero = (
                                Math.round(numero / Math.pow(10, Math.abs(decimales))) * Math.pow(10, Math.abs(decimales))
                                ).toFixed();
                    }
                } else {
                    numero = numero.toString();
                }

                // Damos formato
                partes = numero.split(".", 2);
                array = partes[0].split("");
                for (var i = array.length - 3; i > 0 && array[i - 1] !== "-"; i -= 3) {
                    array.splice(i, 0, separadorMiles);
                }
                numero = array.join("");

                if (partes.length > 1) {
                    numero += separadorDecimal + partes[1];
                }

                return numero;
            }
        </script>
    </body>
</html>