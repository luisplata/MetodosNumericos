<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>JSF+MetodosNumericos</title>
        <!--Import Google Icon Font-->
        <link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
        <meta charset="UTF-8"/>
        <!--Let browser know website is optimized for mobile-->
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <!-- Compiled and minified CSS -->
        <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.6/css/materialize.min.css"/>
        <link rel="stylesheet" href="https://cdn.rawgit.com/leongersen/noUiSlider/master/distribute/nouislider.js"/>
    </head>
    <body>
        <!-- Navbar goes here -->
        <nav>
            <div class="nav-wrapper">
                <a href="#" class="brand-logo center">ABD JSF + Metodos Numericos</a>
                <ul id="nav-mobile" class="right hide-on-med-and-down">
                </ul>
            </div>
        </nav>
        <!-- Page Layout here -->
        <div class="row">
            <div class="col s2">
                <!-- Grey navigation panel -->
                <p>
                    <input class="with-gap" name="group1" type="radio" id="test1" checked="checked"/>
                    <label for="test1">
                        Bisección
                    </label>
                </p>
                <p>
                    <input class="with-gap" name="group1" type="radio" id="test2" />
                    <label for="test2">
                        Falsa posición
                    </label>
                </p>
                <p>
                    <input class="with-gap" name="group1" type="radio" id="test3"  />
                    <label for="test3">
                        Punto Fijo
                    </label>
                </p>
                <p>
                <div class="input-field col s6">
                    <input data-error="Debe Ser entre -100 y 0" data-success="listo!" placeholder="Placeholder" id="numeroInicial" type="number" value="-2"  min="-100" max="0" class="validate">
                    <label for="first_name">Inicio</label>
                </div>
                <div class="input-field col s6">
                    <input data-error="Debe ser entre 0 y 100" data-success="listo!" placeholder="Placeholder" id="numeroFinal" type="number" value="2" min="0" max="100" class="validate">
                    <label for="first_name">Fin</label>
                </div>
                <table class="centered striped table">
                    <thead>
                        <tr>
                            <th colspan="2">Tabla de Valores</th>
                        </tr>
                        <tr>
                            <th>X</th>
                            <th>Y</th>
                        </tr>
                    </thead>
                    <tbody id="xy">
                    </tbody>
                </table>
                </p>
            </div>

            <div class="col s9">
                <!-- Teal page content  -->
                <br/>
                <div class="row">
                    <div class="col s12">
                        <div class="input-field col s5">
                            <input placeholder="3x^3 + 2x^2 + x -1" id="funcion" type="text" class="validate"></input>
                            <label for="first_name">Ingresa la Ecuación</label>
                        </div>
                        <div class="col s1">
                            <a id="Ejecutar" class="btn-floating btn-large waves-effect waves-light red"><i class="material-icons">mode_edit</i></a>
                        </div>
                    </div>
                    <div class="col s12">
                        <div id="myPlot" style="width:100%;height:400px;background-image:'http://i.imgur.com/D7WvclY.gif'"></div>
                    </div>
                    <div class="col s12">
                        <table class="table responsive-table">
                            <thead>
                                <tr>
                                    <td colspan="6" class="center">Pila de Operaciones</td>
                                </tr>
                                <tr>
                                    <th data-field="id">Iteracion #</th>
                                    <th data-field="id">X<small>1</small></th>
                                    <th data-field="name">X<small>2</small></th>
                                    <th data-field="price">X<small>m</small></th>
                                    <th data-field="price">F(x<small>1</small>)</th>
                                    <th data-field="price">F(x<small>2</small>)</th>
                                    <th data-field="price">F(x<small>m</small>)</th>
                                </tr>
                            </thead>

                            <tbody id="Pila">
                            </tbody>
                        </table>
                    </div>

                </div>
            </div>
        </div>
        <div id="resutlado" class="modal">
            <div class="modal-content">
                <h4>La Raiz Es:</h4>
                <p id="resutadoRaiz"></p>
            </div>
            <div class="modal-footer">
                <a href="#!" class=" modal-action modal-close waves-effect waves-green btn-flat">Agree</a>
            </div>
        </div>
        <!--Import jQuery before materialize.js-->
        <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
        <!-- Compiled and minified JavaScript -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.6/js/materialize.min.js"></script>
        <!--Graficador-->
        <script src="https://cdn.rawgit.com/luisplata/fooplot/master/fooplot.js"></script>
        <script src="https://cdn.rawgit.com/josdejong/mathjs/master/dist/math.min.js"></script>

        <script src="https://cdn.rawgit.com/leongersen/noUiSlider/master/distribute/nouislider.js"></script>
        <script>
            var myPlot;
            $(document).ready(function () {

                //gif de cargado: http://i.imgur.com/D7WvclY.gif
                //Lo que vamos a hacer es lo sieguiente:
                /*
                 * Cuando de click, calcularemos la altura y ancho
                 del div donde esta el graficor,
                 * Y colocaremos la imagen del gif como background, y
                 */

                Materialize.updateTextFields();
            });
            $(document).on("click", "#Ejecutar", function () {

                myPlot = new Fooplot(document.getElementById('myPlot'));
                var funcion = $("#funcion").val();
                //myPlot.addPlot('sin(x)+0.5/x', FOOPLOT_TYPE_FUNCTION);
                myPlot.addPlot(funcion, FOOPLOT_TYPE_FUNCTION);
                //myPlot.addPlot('theta', FOOPLOT_TYPE_POLAR, {'color': '#ff0000'});
                myPlot.reDraw();
                tablaxy(parseFloat($("#numeroInicial").val()), parseFloat($("#numeroInicial").val()), parseFloat($("#numeroFinal").val()));
                biseccion(parseFloat($("#numeroInicial").val()), parseFloat($("#numeroFinal").val()), $("#funcion").val(), 0);
            });
            function falsaPosicion(a, b, funcion, iteracion) {
                //Ejecutamos el resultado de f(a), f(b)
                var operacion = math.compile(funcion);
                var positivo = {x: a};
                var negativo = {x: b};
                var fa = operacion.eval(positivo);
                var fb = operacion.eval(negativo);
                var c = a - ((fa * (b - a)) / (fb - fa));
                var raiz = {x: c};
                var fr = operacion.eval(raiz);
                //buscamos el f(c)
                //comparamos la funcion de f(c)
                //Aqui Se Imprime en la tabla

                console.log(a + "|" + b + "|" + c + "|" + parseFloat(fr + "") + "|");
                console.log("Iteracion # " + iteracion);
                //Se Imprime en la tabla
                if (fr > 0) {
                    //es positivo
                    a = c;
                } else {
                    b = c;
                }
                if (fr <= parseFloat(1e-6) && fr >= -parseFloat(1e-6)) {
                    console.log("El Numero es: " + c + " Con la funcion da: " + parseFloat(fr + ""));
                    return;
                }
                iteracion++;
                biseccion(a, b, funcion, iteracion);
            }
            function biseccion(a, b, funcion, iteracion) {
                //Ejecutamos el resultado de f(a), f(b)
                var operacion = math.compile(funcion);
                var c = (a + b) / 2;
                var positivo = {x: a};
                var negativo = {x: b};
                var raiz = {x: c};
                var fa = operacion.eval(positivo);
                var fb = operacion.eval(negativo);
                var fr = operacion.eval(raiz);
                //buscamos el f(c)
                //comparamos la funcion de f(c)
                //Aqui Se Imprime en la tabla
                var tr = $("<tr/>");
                var iteracionNo = $("<td/>", {"html": iteracion});
                tr.append(iteracionNo);
                var tdx1 = $("<td/>", {"html": a.toFixed(8)});
                tr.append(tdx1);
                var tdb1 = $("<td/>", {"html": b.toFixed(8)});
                tr.append(tdb1);
                var tdc1 = $("<td/>", {"html": c.toFixed(8)});
                tr.append(tdc1);
                var tdfx1 = $("<td/>", {"html": fa.toFixed(8)});
                tr.append(tdfx1);
                var tdfb1 = $("<td/>", {"html": fb.toFixed(8)});
                tr.append(tdfb1);
                var tdfc1 = $("<td/>", {"html": fr.toFixed(8)});
                tr.append(tdfc1);
                $("#Pila").append(tr);
                console.log("Positivo    |Negativo    |Raiz    |fr      |");
                console.log(a + "            |" + b + "        |" + c + "    |" + parseFloat(fr + "") + "    |");
                console.log("Iteracion # " + iteracion);
                //Se Imprime en la tabla
                if (fr > 0) {
                    //es positivo
                    a = c;
                } else {
                    b = c;
                }
                if (fr <= parseFloat(1e-5) && fr >= -parseFloat(1e-5)) {
                    console.log("El Numero es: " + c + " Con la funcion da: " + parseFloat(fr + ""));
                    //Colocar el resultado en el modal que anda por ahy con id resultado
                    return;
                }
                iteracion++;
                setTimeout(function () {
                    biseccion(a, b, funcion, iteracion)
                }, 2000);
            }

            function tablaxy(funcion, limiteIzq, limiteDer) {
                var x1;
                var y1;
                var iteraciones = Math.abs(limiteIzq) + Math.abs(limiteDer);
                iteraciones /= 10;
                var funcionLocal = math.compile(funcion);
                for (var i = limiteIzq; i <= limiteDer; i += parseFloat(iteraciones)) {
                    var xx = {x: i};
                    x1 = i;
                    y1 = funcionLocal.eval(xx);
                    var tr = $("<tr/>");
                    var tdx = $('<td/>', {
                        "html": x1.toFixed(6)
                    });
                    var tdy = $('<td/>', {
                        "html": y1.toFixed(6)
                    });
                    tr.append(tdx);
                    tr.append(tdy);
                    console.log(tdx);
                    $("#xy").append(tr);
                    console.log("X= " + x1.toFixed(8));
                    console.log("Y= " + y1.toFixed(8));
                }
            }
        </script>
    </body>
</html>